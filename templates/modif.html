<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>{{repas.name}}</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/card.css') }}"> 
        <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    </head>
    <body>
        <div class='header'>
            <div id="backButton" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i></div>
            <span class="nom-resto">La Cuisine de <span class="leticia">LETICIA <i class="fas fa-utensils"></i> </span></span>
            <div class='navbar'>
                <a href="{{url_for('index')}}"><div class="nav-elt" style="border-bottom: 2px solid orange;">Home</div></a>
                <a href="{{url_for('menu', type='all')}}"><div class="nav-elt">Menu</div></a>
                <a href="#footer"><div class="nav-elt">A propos</div></a>
            </div>
            <a href="#" class="panier-comamnde"><i class="fa-solid fa-cart-shopping"></i></a>
            <a href="#"><div class="btn-login">S'enregistrer</div></a>

            <div class="check">
                <input id="checkbox2" type="checkbox">
                <label class="toggle toggle2" for="checkbox2">
                <div id="bar4" class="bars"></div>
                <div id="bar5" class="bars"></div>
                <div id="bar6" class="bars"></div>
            </div>
            

</label>
        </div>

        <div class='body'>

            <div class="menu">
                <a href="{{url_for('index')}}"><div class="nav-elt">Home</div></a>
                <a href="{{url_for('menu', type='all')}}"><div class="nav-elt" style="border-bottom: 2px solid white;">Menu</div></a>
                <a href="#footer"><div class="nav-elt">A propos</div></a>
                <a href="#"><div class="btn-login2">S'enregistrer</div></a>
            </div>

            <div class="container-repas">
                <div class="img-repas">
                    <label for="photo">
                        <i class="fa-solid fa-camera"></i>
                    </label>
                    <input type="file" id="photo" hidden>
                    <img src="/static/img/repas/{{repas.photo}}" alt="" id="preview">
                </div>

                <!--<div class="info-repas">
                    <div class="info-name">{{ repas.name }}</div>
                    <div class="info-type">{{ repas.type }}</div>
                    <div class="info-prix">Prix : {{ repas.prix }} FCFA</div>
                    <div class="btn-commander">Commander</div>
                </div>-->

                <div class="info-repas">
                    <div class="ligne">
                        <div>Nom : <input id="repas-name" class="info- info-name" value="{{ repas.name }}"></div>
                        <div><input id="repas-id" class="info- info-name" value="{{ repas.id }}" hidden></div>
                    </div>
                    <div class="ligne">
                        <div>Type : <input id="repas-type" class="info- info-type" value="{{ repas.type }}"></div>
                    </div>
                    <div class="ligne">
                        <div>Prix : <input id="repas-prix" class="info- info-prix" value="{{ repas.prix }}"></div>
                    </div>
                    {% if composants != [] %}
                    <div class="composants">
                        <h2>composants</h2>
                        <ul class="liste-composants">
                            {% for comp in composants %}
                                <li><input type="text" value="{{comp}}" class="composant info-"></li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    <div class="btn-">
                        <button class="btn-commander">Commander</button>
                        <button id="update-button" class="btn-commander">Modifier</button>
                    </div>
                </div>
            </div>            
        </div>

        <div class="deco deco1">
            <img class="deco-img" src="{{ url_for('static', filename='img/deco/deco2.jpg') }}" alt="">
        </div>
        <div class="deco deco2">
            <img class="deco-img" src="{{ url_for('static', filename='img/deco/deco3.jpg') }}" alt="">
        </div>
        <div class="deco deco3">
            <img class="deco-img" src="{{ url_for('static', filename='img/deco/deco4.jpg') }}" alt="">
        </div>
        <div class="deco deco4">
            <img class="deco-img" src="{{ url_for('static', filename='img/deco/deco5.jpg') }}" alt="">
        </div>
        <div class="deco deco5">
            <img class="deco-img" src="{{ url_for('static', filename='img/deco/deco6.jpg') }}" alt="">
        </div>

        <div class='footer hidden' id="footer">
            <div class="info">
                <div>
                    <h2>Nos Services</h2>
                    <ul>
                        <li>Livraison a domicile</li>
                        <li>Service traiteur</li>
                        <li>Location de couvert</li>
                        <li>Cube bouillon 100% naurel Leticube</li>
                        <li>Gateaux d'anniversaire</li>
                    </ul>
                </div>
                <div>
                    <h2>Localisation</h2>
                    <ul>
                        <li>Yaounde-Cameroun</li>
                        <li>Prison Konengui</li>
                        <li>Face ancienne brigade</li>
                    </ul>
                </div>

                <div>
                    <h2>Contact</h2>
                    <ul>
                        <li><i class="fa fa-phone"></i> 691 005 801 - 692892 242 - 651 195 677</li>
                        <li><i class="fas fa-envelope"></i> lacuisinedeleticia@gmail.com</li>
                        <li><i class="fab fa-facebook"> <a href="https://www.facebook.com/share/194XwutfqS" style="color: white;"> La cuisine de LETICIA</a></i></li>

            </div>
            <div class="commentaire"></div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const elements = document.querySelectorAll('.hidden');
            
                function checkVisibility() {
                    elements.forEach(element => {
                        const rect = element.getBoundingClientRect();
                        if (rect.top < window.innerHeight && rect.bottom > 0) {
                            element.classList.add('visible');
                        }
                    });
                }
            
                window.addEventListener('scroll', checkVisibility);
                checkVisibility(); // Initial check in case elements are already in view
            });

            document.addEventListener('DOMContentLoaded', function() {
                const checkbox = document.getElementById('checkbox2');
                const menu = document.querySelector('.menu');
            
                checkbox.addEventListener('change', function() {
                    if (checkbox.checked) {
                        menu.style.display = 'flex';
                        setTimeout(() => {
                            menu.style.transform = 'translateY(0)';
                        }, 10);
                    } else {
                        menu.style.transform = 'translateY(-100%)';
                        setTimeout(() => {
                            menu.style.display = 'none';
                        }, 500);
                    }
                });
            });
            function goBack() {
                window.history.back(); // Revient à la page précédente
            }

            document.getElementById('update-button').addEventListener('click', function(event) {
                event.preventDefault(); // Empêche le rechargement de la page
        
                // Récupère les valeurs des champs d'entrée
                const name = document.getElementById('repas-name').value;
                const type = document.getElementById('repas-type').value;
                const prix = document.getElementById('repas-prix').value;
                const id   = document.getElementById('repas-id').value;
                const composants = document.querySelectorAll('.composant');
                const composantsValues = Array.from(composants).map(input => input.value);

                console.log(composantsValues);
        
                // Prépare les données à envoyer
                const data = {
                    name: name,
                    type: type,
                    prix: prix,
                    id  : id,
                    composants: composantsValues
                };
        
                // Envoie les données au serveur Flask via fetch()
                fetch('/update_repas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Réponse du serveur :', data); 
                    alert('Modifie avec succes')// Affiche un message de confirmation
                })
                .catch(error => {
                    console.error('Erreur :', error);
                });
            });

            document.getElementById('photo').addEventListener('change', function(event) {
                const file = event.target.files[0]; // Récupère le fichier sélectionné
                const id   = document.getElementById('repas-id').value;
                console.log('id : ', id);
        
                if (file) {
                    // Affiche un aperçu de l'image sélectionnée
                    const preview = document.getElementById('preview');
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result; // Met à jour l'aperçu
                    };
                    reader.readAsDataURL(file);
        
                    // Prépare les données pour l'envoi
                    const formData = new FormData();
                    formData.append('photo', file);
                    formData.append('id', id);
        
                    // Envoie la photo au serveur
                    fetch('/upload_photo', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Réponse du serveur :', data);
                        alert(data.message); // Affiche un message de confirmation
                    })
                    .catch(error => {
                        console.error('Erreur :', error);
                        alert('Une erreur est survenue lors de l\'envoi de la photo.');
                    });
                } else {
                    alert('Aucune photo sélectionnée.');
                }
            });
            </script>
        
    </body>
</html>